<!DOCTYPE html>
{% assign rawlang = page.lang | default: 'en' %}
{% if rawlang != 'en' and rawlang != 'de' %}{% assign rawlang = 'en' %}{% endif %}
<html lang="{{ rawlang }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if page.title %}{{ page.title }} | {% endif %}{{ site.title }}</title>
    <meta name="description" content="{{ page.description | default: site.description }}">
    <!-- Unified Bootstrap & Fonts -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <!-- Unified site stylesheet -->
    <link rel="stylesheet" type="text/css" href="/css/site.css">
    {% if page.extra_css %}
        {% for css in page.extra_css %}
        <link rel="stylesheet" href="{{ css }}">
        {% endfor %}
    {% endif %}
    {% if page.cv %}{% comment %}CV specific styles consolidated to site.css{% endcomment %}{% endif %}
    {% if page.head_extra %}{{ page.head_extra }}{% endif %}
</head>
<body class="{% if page.body_class %}{{ page.body_class }}{% endif %}">
    {% include header.html %}
    <main>
        {{ content }}
    </main>
    {% if page.include_modals %}
        {% include modals.html %}
    {% endif %}
    {% include footer.html %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/anim1.js"></script>
    {% if page.cv %}
    
    <!-- Ensure Bootstrap navbar functionality on CV pages -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const elements = {
            navbar: document.querySelector('.navbar'),
            navbarCollapse: document.querySelector('.navbar-collapse'),
            dropdown: document.querySelector('.nav-item.dropdown'),
            dropdownButton: document.querySelector('#languageDropdown'),
            navbarToggler: document.querySelector('.navbar-toggler')
        };
        
        function setupDesktopNavbar() {
            if (elements.navbar) {
                elements.navbar.classList.remove('navbar-dark');
                elements.navbar.classList.add('navbar-light');
            }
            
            if (elements.navbarCollapse) {
                elements.navbarCollapse.classList.add('show');
                elements.navbarCollapse.style.display = 'flex';
            }
            
            if (elements.dropdown) {
                elements.dropdown.style.display = 'block';
                elements.dropdown.style.visibility = 'visible';
            }
            
            if (elements.dropdownButton) {
                elements.dropdownButton.style.display = 'inline-flex';
                elements.dropdownButton.style.alignItems = 'center';
                elements.dropdownButton.style.visibility = 'visible';
            }
        }
        
        function setupMobileNavbar() {
            if (elements.navbarCollapse) {
                elements.navbarCollapse.style.display = '';
                const isExpanded = elements.navbarToggler && elements.navbarToggler.getAttribute('aria-expanded') === 'true';
                if (!isExpanded) {
                    elements.navbarCollapse.classList.remove('show');
                }
            }
            
            if (elements.dropdown) {
                elements.dropdown.style.display = '';
                elements.dropdown.style.visibility = '';
            }
            
            if (elements.dropdownButton) {
                elements.dropdownButton.style.display = '';
                elements.dropdownButton.style.alignItems = '';
                elements.dropdownButton.style.visibility = '';
            }
        }
        
        function handleNavbarDisplay() {
            if (window.innerWidth >= 992) {
                setupDesktopNavbar();
            } else {
                setupMobileNavbar();
            }
        }
        
        function setupMobileMenuClosing() {
            if (window.innerWidth < 992 && elements.navbarCollapse) {
                const navLinks = document.querySelectorAll('.navbar-nav .nav-link:not(.dropdown-toggle)');
                navLinks.forEach(link => {
                    link.addEventListener('click', function() {
                        const bsCollapse = bootstrap.Collapse.getInstance(elements.navbarCollapse) || 
                                         new bootstrap.Collapse(elements.navbarCollapse, {toggle: false});
                        bsCollapse.hide();
                    });
                });
            }
        }
        
        // Initialize
        handleNavbarDisplay();
        setupMobileMenuClosing();
        
        // Handle window resize
        let resizeTimeout;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(handleNavbarDisplay, 150);
        });
        
        console.log('CV navbar functionality with mobile support restored');
    });
    </script>
    {% endif %}
    {% if page.extra_js %}
    {% for js in page.extra_js %}
        <script src="{{ js }}"></script>
    {% endfor %}
    {% endif %}
</body>
</html>
